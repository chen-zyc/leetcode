- [42. æ¥é›¨æ°´](#42-æ¥é›¨æ°´)
  - [å®˜æ–¹é¢˜è§£](#å®˜æ–¹é¢˜è§£)
    - [æ–¹æ³• 1ï¼šæš´åŠ›](#æ–¹æ³•-1æš´åŠ›)
    - [æ–¹æ³• 2ï¼šåŠ¨æ€ç¼–ç¨‹](#æ–¹æ³•-2åŠ¨æ€ç¼–ç¨‹)
    - [æ–¹æ³• 3ï¼šæ ˆçš„åº”ç”¨](#æ–¹æ³•-3æ ˆçš„åº”ç”¨)
    - [æ–¹æ³• 4ï¼šä½¿ç”¨åŒæŒ‡é’ˆ](#æ–¹æ³•-4ä½¿ç”¨åŒæŒ‡é’ˆ)

------------------------------

# 42. æ¥é›¨æ°´

ç»™å®š n ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º 1 çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚

![](assets/no_0042_trapping_rain_water1.png)

ä¸Šé¢æ˜¯ç”±æ•°ç»„ `[0,1,0,2,1,0,1,3,2,1,2,1]` è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ 6 ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚Â æ„Ÿè°¢ Marcos è´¡çŒ®æ­¤å›¾ã€‚

ç¤ºä¾‹:

```
è¾“å…¥: [0,1,0,2,1,0,1,3,2,1,2,1]
è¾“å‡º: 6
```

- æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰
- é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/trapping-rain-water
- è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

> è¿æœ€æš´åŠ›çš„æ–¹æ³•ä¹Ÿæ²¡æœ‰æƒ³åˆ° ğŸ˜¥

## å®˜æ–¹é¢˜è§£

> é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/trapping-rain-water/solution/jie-yu-shui-by-leetcode/

### æ–¹æ³• 1ï¼šæš´åŠ›

**ç›´è§‚æƒ³æ³•**

ç›´æ¥æŒ‰é—®é¢˜æè¿°è¿›è¡Œã€‚å¯¹äºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬æ‰¾å‡ºä¸‹é›¨åæ°´èƒ½è¾¾åˆ°çš„æœ€é«˜ä½ç½®ï¼Œç­‰äºä¸¤è¾¹æœ€å¤§é«˜åº¦çš„è¾ƒå°å€¼å‡å»å½“å‰é«˜åº¦çš„å€¼ã€‚

**ç®—æ³•**

- åˆå§‹åŒ– $ans=0$
- ä»å·¦å‘å³æ‰«ææ•°ç»„ï¼š
    - åˆå§‹åŒ– $\text{max\_left}=0$ å’Œ $\text{max\_right}=0$
    - ä»å½“å‰å…ƒç´ å‘å·¦æ‰«æå¹¶æ›´æ–°ï¼š
        - $\text{max\_left}=\max(\text{max\_left},\text{height}[j])$
    - ä»å½“å‰å…ƒç´ å‘å³æ‰«æå¹¶æ›´æ–°ï¼š
        - $\text{max\_right}=\max(\text{max\_right},\text{height}[j])$
    - å°† $\min(\text{max\_left},\text{max\_right}) - \text{height}[i]$ ç´¯åŠ åˆ° $\text{ans}$ (è¿™ä¸€æ­¥è®¡ç®—çš„æ˜¯åœ¨ `[i]` è¿™ä¸ªä½ç½®ä¸Šçš„æ°´æ·±)

```c++
int trap(vector<int>& height)
{
    int ans = 0;
    int size = height.size();
    for (int i = 1; i < size - 1; i++) {
        int max_left = 0, max_right = 0;
        for (int j = i; j >= 0; j--) { //Search the left part for max bar size
            max_left = max(max_left, height[j]);
        }
        for (int j = i; j < size; j++) { //Search the right part for max bar size
            max_right = max(max_right, height[j]);
        }
        ans += min(max_left, max_right) - height[i];
    }
    return ans;
}
```

**å¤æ‚æ€§åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦å‘å·¦å‘å³æ‰«æã€‚
- ç©ºé—´å¤æ‚åº¦ $O(1)$ çš„é¢å¤–ç©ºé—´ã€‚

> è¿™ä¸ªæ¯æ¬¡è®¡ç®—çš„æ˜¯ä¸€ä¸ªæ ¼å­çš„æ°´æ·±ï¼Œçºµå‘çš„ã€‚


### æ–¹æ³• 2ï¼šåŠ¨æ€ç¼–ç¨‹

**ç›´è§‚æƒ³æ³•**

åœ¨æš´åŠ›æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…ä¸ºäº†æ‰¾åˆ°æœ€å¤§å€¼æ¯æ¬¡éƒ½è¦å‘å·¦å’Œå‘å³æ‰«æä¸€æ¬¡ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æå‰å­˜å‚¨è¿™ä¸ªå€¼ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€ç¼–ç¨‹è§£å†³ã€‚

è¿™ä¸ªæ¦‚å¿µå¯ä»¥è§ä¸‹å›¾è§£é‡Šï¼š

![](assets/no_0042_trapping_rain_water2.png)

**ç®—æ³•**

- æ‰¾åˆ°æ•°ç»„ä¸­ä»ä¸‹æ ‡ i åˆ°æœ€å·¦ç«¯æœ€é«˜çš„æ¡å½¢å—é«˜åº¦ $\text{left\_max}$ã€‚
- æ‰¾åˆ°æ•°ç»„ä¸­ä»ä¸‹æ ‡ i åˆ°æœ€å³ç«¯æœ€é«˜çš„æ¡å½¢å—é«˜åº¦ $\text{right\_max}$ã€‚
- æ‰«ææ•°ç»„ $\text{height}$ å¹¶æ›´æ–°ç­”æ¡ˆï¼š
    - ç´¯åŠ  $\min(\text{max\_left}[i],\text{max\_right}[i]) - \text{height}[i]$ åˆ° $ans$ ä¸Š

```c++
int trap(vector<int>& height)
{
	if(height == null)
		return 0;
    int ans = 0;
    int size = height.size();
    vector<int> left_max(size), right_max(size);
    left_max[0] = height[0];
    for (int i = 1; i < size; i++) {
        left_max[i] = max(height[i], left_max[i - 1]);
    }
    right_max[size - 1] = height[size - 1];
    for (int i = size - 2; i >= 0; i--) {
        right_max[i] = max(height[i], right_max[i + 1]);
    }
    for (int i = 1; i < size - 1; i++) {
        ans += min(left_max[i], right_max[i]) - height[i];
    }
    return ans;
}
```

**å¤æ‚æ€§åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚
    - å­˜å‚¨æœ€å¤§é«˜åº¦æ•°ç»„ï¼Œéœ€è¦ä¸¤æ¬¡éå†ï¼Œæ¯æ¬¡ $O(n)$ ã€‚
    - æœ€ç»ˆä½¿ç”¨å­˜å‚¨çš„æ•°æ®æ›´æ–° $\text{ans}$ ï¼Œ$O(n)$ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ é¢å¤–ç©ºé—´ã€‚
    - å’Œæ–¹æ³• 1 ç›¸æ¯”ä½¿ç”¨äº†é¢å¤–çš„ $O(n)$ ç©ºé—´ç”¨æ¥æ”¾ç½® $\text{left\_max}$ å’Œ $\text{right\_max}$ æ•°ç»„ã€‚


### æ–¹æ³• 3ï¼šæ ˆçš„åº”ç”¨

**ç›´è§‚æƒ³æ³•**

æˆ‘ä»¬å¯ä»¥ä¸ç”¨åƒæ–¹æ³• 2 é‚£æ ·å­˜å‚¨æœ€å¤§é«˜åº¦ï¼Œè€Œæ˜¯ç”¨æ ˆæ¥è·Ÿè¸ªå¯èƒ½å‚¨æ°´çš„æœ€é•¿çš„æ¡å½¢å—ã€‚ä½¿ç”¨æ ˆå°±å¯ä»¥åœ¨ä¸€æ¬¡éå†å†…å®Œæˆè®¡ç®—ã€‚

æˆ‘ä»¬åœ¨éå†æ•°ç»„æ—¶ç»´æŠ¤ä¸€ä¸ªæ ˆã€‚å¦‚æœå½“å‰çš„æ¡å½¢å—å°äºæˆ–ç­‰äºæ ˆé¡¶çš„æ¡å½¢å—ï¼Œæˆ‘ä»¬å°†æ¡å½¢å—çš„ç´¢å¼•å…¥æ ˆï¼Œæ„æ€æ˜¯å½“å‰çš„æ¡å½¢å—è¢«æ ˆä¸­çš„å‰ä¸€ä¸ªæ¡å½¢å—ç•Œå®šã€‚å¦‚æœæˆ‘ä»¬å‘ç°ä¸€ä¸ªæ¡å½¢å—é•¿äºæ ˆé¡¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ ˆé¡¶çš„æ¡å½¢å—è¢«å½“å‰æ¡å½¢å—å’Œæ ˆçš„å‰ä¸€ä¸ªæ¡å½¢å—ç•Œå®š(è¦æŠŠ 3 ä¸ªå—å‚è€ƒè¿›æ¥ç†è§£)ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¼¹å‡ºæ ˆé¡¶å…ƒç´ å¹¶ä¸”ç´¯åŠ ç­”æ¡ˆåˆ° $\text{ans}$ã€‚

**ç®—æ³•**

- ä½¿ç”¨æ ˆæ¥å­˜å‚¨æ¡å½¢å—çš„ç´¢å¼•ä¸‹æ ‡ã€‚
- éå†æ•°ç»„ï¼š
    - å½“æ ˆéç©ºä¸” $\text{height}[current]>\text{height}[st.top()]$
        - æ„å‘³ç€æ ˆä¸­å…ƒç´ å¯ä»¥è¢«å¼¹å‡ºã€‚å¼¹å‡ºæ ˆé¡¶å…ƒç´  $\text{top}$ã€‚
        - è®¡ç®—å½“å‰å…ƒç´ å’Œæ ˆé¡¶å…ƒç´ çš„è·ç¦»ï¼Œå‡†å¤‡è¿›è¡Œå¡«å……æ“ä½œ $\text{distance} = \text{current} - \text{st.top}() - 1$
        - æ‰¾å‡ºç•Œå®šé«˜åº¦ $\text{bounded\_height} = \min(\text{height[current]}, \text{height[st.top()]}) - \text{height[top]}$
        - å¾€ç­”æ¡ˆä¸­ç´¯åŠ ç§¯æ°´é‡ $\text{ans} \mathrel{+}= \text{distance} \times \text{bounded\_height}$
    - å°†å½“å‰ç´¢å¼•ä¸‹æ ‡å…¥æ ˆ
    - å°† $\text{current}$ ç§»åŠ¨åˆ°ä¸‹ä¸ªä½ç½®

```c++
int trap(vector<int>& height)
{
    int ans = 0, current = 0;
    stack<int> st;
    while (current < height.size()) {
        while (!st.empty() && height[current] > height[st.top()]) {
            int top = st.top();
            st.pop();
            if (st.empty())
                break;
            // - 1 æ˜¯å› ä¸ºè¦æŠŠå·¦å³ä¸¤ä¸ªè¾¹ç•Œéƒ½å»æ‰ã€‚
            int distance = current - st.top() - 1;
            int bounded_height = min(height[current], height[st.top()]) - height[top];
            ans += distance * bounded_height;
        }
        st.push(current++);
    }
    return ans;
}
```

**å¤æ‚æ€§åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚
    - å•æ¬¡éå† $O(n)$ ï¼Œæ¯ä¸ªæ¡å½¢å—æœ€å¤šè®¿é—®ä¸¤æ¬¡ï¼ˆç”±äºæ ˆçš„å¼¹å…¥å’Œå¼¹å‡ºï¼‰ï¼Œå¹¶ä¸”å¼¹å…¥å’Œå¼¹å‡ºæ ˆéƒ½æ˜¯ $O(1)$ çš„ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚ æ ˆæœ€å¤šåœ¨é˜¶æ¢¯å‹æˆ–å¹³å¦å‹æ¡å½¢å—ç»“æ„ä¸­å ç”¨ $O(n)$ çš„ç©ºé—´ã€‚

ä¸‹é¢æ˜¯æˆ‘æ ¹æ®ä»£ç ç®—çš„è¿‡ç¨‹ï¼š

![](assets/no_0042_trapping_rain_water3.png)

![](assets/no_0042_trapping_rain_water4.png)

> è¿™ä¸ªæ¯æ¬¡è®¡ç®—æ˜¯æŒ‰æ¨ªå‘çš„ã€‚
> 
> è§†é¢‘ä¸­è®²è§£ï¼štop çš„å‰é¢ä¸€ä¸ªæ¯”å®ƒé«˜ï¼Œè€Œ current ä¹Ÿæ¯” top é«˜ï¼Œæ‰€ä»¥åœ¨ top å¤„ä¼šå½¢æˆä½æ´¼ã€‚



### æ–¹æ³• 4ï¼šä½¿ç”¨åŒæŒ‡é’ˆ

**ç›´è§‚æƒ³æ³•**

å’Œæ–¹æ³• 2 ç›¸æ¯”ï¼Œæˆ‘ä»¬ä¸ä»å·¦å’Œä»å³åˆ†å¼€è®¡ç®—ï¼Œæˆ‘ä»¬æƒ³åŠæ³•ä¸€æ¬¡å®Œæˆéå†ã€‚

ä»åŠ¨æ€ç¼–ç¨‹æ–¹æ³•çš„ç¤ºæ„å›¾ä¸­æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåªè¦ $\text{right\_max}[i]>\text{left\_max}[i]$ ï¼ˆå…ƒç´  0 åˆ°å…ƒç´  6ï¼‰ï¼Œç§¯æ°´é«˜åº¦å°†ç”± `left_max` å†³å®šï¼Œç±»ä¼¼åœ° $\text{left\_max}[i]>\text{right\_max}[i]$ï¼ˆå…ƒç´  8 åˆ°å…ƒç´  11ï¼‰ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå¦‚æœä¸€ç«¯æœ‰æ›´é«˜çš„æ¡å½¢å—ï¼ˆä¾‹å¦‚å³ç«¯ï¼‰ï¼Œç§¯æ°´çš„é«˜åº¦ä¾èµ–äºå½“å‰æ–¹å‘çš„é«˜åº¦ï¼ˆä»å·¦åˆ°å³ï¼‰ã€‚å½“æˆ‘ä»¬å‘ç°å¦ä¸€ä¾§ï¼ˆå³ä¾§ï¼‰çš„æ¡å½¢å—é«˜åº¦ä¸æ˜¯æœ€é«˜çš„ï¼Œæˆ‘ä»¬åˆ™å¼€å§‹ä»ç›¸åçš„æ–¹å‘éå†ï¼ˆä»å³åˆ°å·¦ï¼‰ã€‚

> ä¸Šé¢è¿™å¥è¿™æ ·ç†è§£ï¼š
> 
> å‡è®¾å³è¾¹æœ‰ä¸€æ ¹éå¸¸é«˜çš„æŸ±å­ï¼Œé‚£ä¹ˆä½æ´¼å¤„çš„æ°´æ·±å–å†³äºå·¦è¾¹çš„æŸ±å­é«˜åº¦ï¼š
> ![](assets/no_0042_trapping_rain_water5.png)
>
> åŒæ ·åœ°,
>
> å‡è®¾å·¦è¾¹æœ‰ä¸€æ ¹éå¸¸é«˜çš„æŸ±å­ï¼Œé‚£ä¹ˆä½æ´¼å¤„çš„æ°´æ·±å–å†³äºå³è¾¹çš„æŸ±å­çš„é«˜åº¦ï¼š
> ![](assets/no_0042_trapping_rain_water6.png)

æˆ‘ä»¬å¿…é¡»åœ¨éå†æ—¶ç»´æŠ¤ $\text{left\_max}$ å’Œ $\text{right\_max}$ ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆäº¤æ›¿è¿›è¡Œï¼Œå®ç° 1 æ¬¡éå†å³å¯å®Œæˆã€‚

![](assets/no_0042_trapping_rain_water7.gif)

**ç®—æ³•**

- åˆå§‹åŒ– $\text{left}$ æŒ‡é’ˆä¸º 0 å¹¶ä¸” $\text{right}$ æŒ‡é’ˆä¸º size-1
- While $\text{left}< \text{right}$, do:
    - If $\text{height[left]} < \text{height[right]}$ ï¼ˆå³è¾¹æœ‰ä¸€æ ¹å¾ˆé«˜çš„æŸ±å­ï¼Œé‚£ä¹ˆä½æ´¼å¤„çš„æ°´æ·±å–å†³äºå·¦è¾¹çš„å€¼ï¼‰
        - If $\text{height[left]} \geq \text{left\_max}$, æ›´æ–° $\text{left\_max}$ ï¼ˆå¦‚æœ `height[left] >= left_max`ï¼Œè¯´æ˜æŸ±å­æ˜¯è¶Šæ¥è¶Šé«˜çš„ï¼‰
        - Else ç´¯åŠ  $\text{left\_max}-\text{height[left]}$ åˆ° $\text{ans}$ï¼ˆå¦åˆ™æ˜¯è¶Šæ¥è¶Šä½çš„ï¼Œé‚£ä¹ˆå®ƒçš„å·¦è¾¹å’Œ `[right]` å°±ä¼šå½¢æˆä½æ´¼å¤„ï¼‰
        - $\text{left} = \text{left} + 1$.
    - Else
        - If $\text{height[right]} \geq \text{right\_max}$, æ›´æ–° $\text{right\_max}$
        - Else ç´¯åŠ  $\text{right\_max}-\text{height[right]}$ åˆ° $\text{ans}$
        - $\text{right} = \text{right} - 1$.

```c++
int trap(vector<int>& height)
{
    int left = 0, right = height.size() - 1;
    int ans = 0;
    int left_max = 0, right_max = 0;
    while (left < right) {
        if (height[left] < height[right]) { 
            height[left] >= left_max ? (left_max = height[left]) : ans += (left_max - height[left]);
            ++left;
        }
        else {
            height[right] >= right_max ? (right_max = height[right]) : ans += (right_max - height[right]);
            --right;
        }
    }
    return ans;
}
```

**å¤æ‚æ€§åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ã€‚å•æ¬¡éå†çš„æ—¶é—´$O(n)$ã€‚
- ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ çš„é¢å¤–ç©ºé—´ã€‚$\text{left}$, $\text{right}$, $\text{left\_max}$ å’Œ $\text{right\_max}$ åªéœ€è¦å¸¸æ•°çš„ç©ºé—´ã€‚
